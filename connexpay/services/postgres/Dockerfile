ARG POSTGRES_VERSION=latest
FROM postgres:${POSTGRES_VERSION}

# Install necessary tools
RUN apt-get update && \
    apt-get install -y \
    ca-certificates \
    curl \
    openssl \
    wget

# Copy your corporate certificate
COPY ZscalerRootCertificate.crt /usr/local/share/ca-certificates/

# Add the certificate and update the certificate store
RUN cp /usr/local/share/ca-certificates/ZscalerRootCertificate.crt /etc/ssl/certs/ && \
    # Revert to HTTPS repositories
    sed -i 's/http:/https:/g' /etc/apt/sources.list.d/* /etc/apt/sources.list || true && \
    update-ca-certificates

# Create a script to verify certificate
RUN echo '#!/bin/bash' > /verify-ssl.sh && \
    echo 'echo "Verifying SSL connection..."' >> /verify-ssl.sh && \
    echo 'curl -v https://deno.land' >> /verify-ssl.sh && \
    chmod +x /verify-ssl.sh